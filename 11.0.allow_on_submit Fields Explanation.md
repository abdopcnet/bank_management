# allow_on_submit Fields in Bank Transaction

## Why allow_on_submit?

**`allow_on_submit: 1`** means these fields can be edited even after the Bank Transaction is **Submitted** (docstatus = 1).

**Reason**: Bank Transactions are auto-submitted when imported from bank statement. But reconciliation happens **after** submission. Users need to update these fields during reconciliation without canceling/submitting again.

---

## Fields with allow_on_submit in Bank Transaction:

**Total**: **6 fields**

### 1. `reference_number` (Line 120)

**Why allowed**: Reference number may be missing or wrong in bank statement. User needs to add/correct it for reconciliation.

**Usage**: Updated via "Update Bank Transaction" dialog or direct edit.

---

### 2. `payment_entries` (Line 132)

**Why allowed**: This table stores matched vouchers. Reconciliation happens after submission, so this table must be editable.

**Usage**: Auto-updated by `reconcile_vouchers()` function when matching vouchers.

---

### 3. `allocated_amount` (Line 143)

**Why allowed**: This field shows total matched amount. It updates during reconciliation (after submission).

**Usage**: Auto-calculated from `payment_entries` table.

---

### 4. `unallocated_amount` (Line 164)

**Why allowed**: This field shows remaining unmatched amount. It updates during reconciliation (after submission).

**Usage**: Auto-calculated: `|deposit - withdrawal| - allocated_amount`

---

### 5. `party_type` (Line 177)

**Why allowed**: Party information may be missing from bank statement. User needs to add it for better matching.

**Usage**: Updated via "Update Bank Transaction" dialog for auto-reconcile.

---

### 6. `party` (Line 184)

**Why allowed**: Party name may be missing from bank statement. User needs to add it for better matching.

**Usage**: Updated via "Update Bank Transaction" dialog for auto-reconcile.

---

## Summary Table:

| Field                | Type         | Why Editable After Submit                  | Updated By                  |
| -------------------- | ------------ | ------------------------------------------ | --------------------------- |
| `reference_number`   | Small Text   | Missing/wrong in bank statement            | User or Update Dialog       |
| `payment_entries`    | Table        | Stores matched vouchers (reconciled later) | Auto (reconcile_vouchers)   |
| `allocated_amount`   | Currency     | Calculated from matched vouchers           | Auto (from payment_entries) |
| `unallocated_amount` | Currency     | Calculated remaining amount                | Auto (formula)              |
| `party_type`         | Link         | Missing from bank statement                | User or Update Dialog       |
| `party`              | Dynamic Link | Missing from bank statement                | User or Update Dialog       |

---

## Workflow:

1. **Bank Statement Import**: Creates Bank Transaction → **Auto-submitted** (docstatus = 1)
2. **Reconciliation**: Happens **after** submission
3. **Update Fields**: User can update `reference_number`, `party_type`, `party` for better matching
4. **Auto-Update**: System updates `payment_entries`, `allocated_amount`, `unallocated_amount` during reconciliation

---

## Key Point:

Without `allow_on_submit`, users would need to:

-   Cancel Bank Transaction → Edit → Submit again
-   This is not practical for reconciliation workflow

With `allow_on_submit`, reconciliation can happen smoothly on submitted documents.
