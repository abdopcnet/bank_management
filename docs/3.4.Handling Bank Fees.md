# Case 3F: Handling Bank Fees

## Understanding Fee Fields:

-   **`included_fee`**: Fee included within the withdrawal/deposit amount (part of the transaction)
-   **`excluded_fee`**: Fee deducted separately (auto-converts to `included_fee` on save)

**Note**: `excluded_fee` auto-converts to `included_fee` and adjusts deposit/withdrawal amount.

---

## Scenario 3F1: Periodic Account Fees (Monthly/Annual Fees)

**Bank Statement Example**: Monthly service charge deducted from account

**Bank Transaction Fields**:

```
withdrawal: 100
included_fee: 0
excluded_fee: 0
description: "Monthly Bank Service Charges"
reference_number: "FEE-MONTHLY-001"
```

**OR (if fee shown separately in statement)**:

```
withdrawal: 100
included_fee: 0
excluded_fee: 100
description: "Monthly Bank Service Charges"
reference_number: "FEE-MONTHLY-001"
```

### Steps:

1. **Upload Bank Statement**: System creates Bank Transaction with fee

2. **Dialog: Reconcile Bank Transaction**:

    - `action`: **"Create Voucher"**
    - `document_type`: **"Journal Entry"**

3. **Fill Fields**:

    - `journal_entry_type`: **"Bank Entry"**
    - `second_account`: **"Bank Charges"** (expense account)
    - `reference_number`: **"FEE-MONTHLY-001"** (auto-filled)
    - `posting_date`: **2024-01-15** (auto-filled)
    - `reference_date`: **2024-01-15** (auto-filled)

4. **Click "Reconcile"**:
    - System creates Journal Entry:
        - Bank Account (Credit: 100)
        - Bank Charges (Debit: 100)
    - **Result**: Journal Entry created, submitted, and matched

---

## Scenario 3F2: Random Account Fees (Unexpected Fees)

**Bank Statement Example**: Unplanned fee or penalty charge

**Bank Transaction Fields**:

```
withdrawal: 50
included_fee: 0
excluded_fee: 0
description: "Penalty Fee - Minimum Balance"
reference_number: "FEE-PENALTY-001"
```

**OR (if fee shown separately)**:

```
withdrawal: 50
included_fee: 0
excluded_fee: 50
description: "Penalty Fee - Minimum Balance"
reference_number: "FEE-PENALTY-001"
```

### Steps:

1. **Upload Bank Statement**: System creates Bank Transaction

2. **Dialog: Reconcile Bank Transaction**:

    - `action`: **"Create Voucher"**
    - `document_type`: **"Journal Entry"**

3. **Fill Fields**:

    - `journal_entry_type`: **"Bank Entry"**
    - `second_account`: **"Bank Charges"** or **"Penalty Fees"** (expense account)
    - `reference_number`: **"FEE-PENALTY-001"** (auto-filled)
    - `posting_date`: **2024-01-15** (auto-filled)
    - `reference_date`: **2024-01-15** (auto-filled)

4. **Click "Reconcile"**:
    - System creates Journal Entry:
        - Bank Account (Credit: 50)
        - Bank Charges/Penalty Fees (Debit: 50)
    - **Result**: Journal Entry created, submitted, and matched

---

## Scenario 3F3: Transaction Fees (Fees Related to Deposit/Withdrawal)

### Case A: Fee on Deposit (Customer Payment Fee)

**Bank Statement Example**: Customer payment received, but bank deducted fee

**Bank Transaction Fields**:

```
deposit: 1000
included_fee: 0
excluded_fee: 25
description: "Payment from Customer ABC - Transaction Fee"
reference_number: "CHQ-001"
party_type: Customer
party: Customer ABC
```

**Note**: System auto-converts `excluded_fee` to `included_fee`:

-   After save: `deposit: 975`, `included_fee: 25`, `excluded_fee: 0`

### Steps:

1. **Upload Bank Statement**: System creates Bank Transaction

2. **Dialog: Reconcile Bank Transaction**:

    - **Option 1**: Match against existing Payment Entry (if customer payment already recorded)
        - `action`: **"Match Against Voucher"**
        - Select Payment Entry
    - **Option 2**: Create Payment Entry for customer + Journal Entry for fee
        - First: Create Payment Entry (amount: 975)
        - Then: Create Journal Entry for fee (amount: 25)
            - `action`: **"Create Voucher"**
            - `document_type`: **"Journal Entry"**
            - `second_account`: **"Transaction Fees"** (expense account)

3. **Fill Fields (Journal Entry)**:

    - `journal_entry_type`: **"Bank Entry"**
    - `second_account`: **"Transaction Fees"**
    - `reference_number`: **"CHQ-001-FEE"**
    - `posting_date`: **2024-01-15**
    - `reference_date`: **2024-01-15**

4. **Click "Reconcile"**:
    - **Result**: Payment Entry matched (975) + Journal Entry matched (25) = Fully reconciled (1000)

---

### Case B: Fee on Withdrawal (Wire Transfer Fee)

**Bank Statement Example**: Supplier payment made, bank charged transfer fee

**Bank Transaction Fields**:

```
withdrawal: 5000
included_fee: 0
excluded_fee: 50
description: "Payment to Supplier XYZ - Wire Transfer Fee"
reference_number: "WIRE-001"
party_type: Supplier
party: Supplier XYZ
```

**Note**: System auto-converts: `withdrawal: 5050`, `included_fee: 50`, `excluded_fee: 0`

### Steps:

1. **Upload Bank Statement**: System creates Bank Transaction

2. **Dialog: Reconcile Bank Transaction**:

    - **Option 1**: Match against existing Payment Entry (if supplier payment already recorded)
        - Match Payment Entry (amount: 5000)
        - Create Journal Entry for fee (amount: 50)
    - **Option 2**: Create Payment Entry for supplier + Journal Entry for fee
        - Create Payment Entry (amount: 5000)
        - Create Journal Entry (amount: 50)

3. **Fill Fields (Journal Entry)**:

    - `journal_entry_type`: **"Bank Entry"**
    - `second_account`: **"Wire Transfer Fees"** (expense account)
    - `reference_number`: **"WIRE-001-FEE"**
    - `posting_date`: **2024-01-15**
    - `reference_date`: **2024-01-15**

4. **Click "Reconcile"**:
    - **Result**: Payment Entry matched (5000) + Journal Entry matched (50) = Fully reconciled (5050)

---

### Case C: Fee Included in Withdrawal Amount

**Bank Statement Example**: Withdrawal shows total amount (includes fee)

**Bank Transaction Fields**:

```
withdrawal: 1050
included_fee: 50
excluded_fee: 0
description: "Payment to Supplier XYZ"
reference_number: "CHQ-002"
party_type: Supplier
party: Supplier XYZ
```

### Steps:

1. **Match or Create Payment Entry**: Amount = 1000 (1050 - 50 fee)

2. **Create Journal Entry for Fee**:

    - `action`: **"Create Voucher"**
    - `document_type`: **"Journal Entry"**
    - `journal_entry_type`: **"Bank Entry"**
    - `second_account`: **"Transaction Fees"**
    - `reference_number`: **"CHQ-002-FEE"**
    - Amount: 50

3. **Click "Reconcile"**:
    - **Result**: Payment Entry (1000) + Journal Entry (50) = Fully reconciled (1050)

---

## Fee Handling Summary Table:

| Fee Type                       | Bank Statement                  | Bank Transaction Fields                                 | Action                                               |
| ------------------------------ | ------------------------------- | ------------------------------------------------------- | ---------------------------------------------------- |
| **Periodic Fee**               | Withdrawal 100 (service charge) | `withdrawal: 100`, `included_fee: 0`, `excluded_fee: 0` | Create Journal Entry (amount: 100)                   |
| **Random Fee**                 | Withdrawal 50 (penalty)         | `withdrawal: 50`, `included_fee: 0`, `excluded_fee: 0`  | Create Journal Entry (amount: 50)                    |
| **Transaction Fee (Excluded)** | Deposit 1000, Fee 25 separate   | `deposit: 1000`, `excluded_fee: 25`                     | Auto-converts to: `deposit: 975`, `included_fee: 25` |
| **Transaction Fee (Included)** | Withdrawal 1050 (1000 + 50 fee) | `withdrawal: 1050`, `included_fee: 50`                  | Create Payment Entry (1000) + Journal Entry (50)     |

**Key Rules**:

-   `excluded_fee` → Auto-converts to `included_fee` on save
-   For transaction fees: Create Payment Entry for party amount + Journal Entry for fee
-   All fees (account or transaction) → Use Journal Entry with expense account
